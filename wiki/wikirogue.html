<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WikiRogue</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        .game-container {
            width: 90%;
            max-width: 1200px;
            text-align: center;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .title a {
            color: white;
            text-decoration: none;
        }

        .title a:hover {
            text-decoration: none;
        }

        .stats {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            font-size: 1.2rem;
        }

        .battlefield {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .battle-column {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .column-label {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #FFD700;
            text-transform: uppercase;
        }

        .opponent-slot, .player-slot {
            width: 160px;
            height: 120px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            margin-bottom: 1rem;
        }

        .player-slot {
            border-style: dashed;
            border-color: rgba(255,255,255,0.5);
        }

        .player-slot.drag-over {
            border-color: #4CAF50;
            background: rgba(76,175,80,0.2);
            transform: scale(1.05);
        }

        .card {
            width: 150px;
            height: 110px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .card-title {
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 8px;
            line-height: 1.2;
            height: 2.4rem;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .card-stats {
            font-size: 0.7rem;
            line-height: 1.3;
        }

        .stat-line {
            margin: 2px 0;
            display: flex;
            justify-content: space-between;
        }

        .stat-value {
            font-weight: bold;
            color: #FFD700;
        }

        .stat-hidden {
            font-weight: bold;
            color: #888;
        }

        .player-hand {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .game-over {
            display: none;
        }

        .game-over-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            border: 3px solid rgba(255,255,255,0.3);
        }

        .battle-result {
            display: none;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            backdrop-filter: blur(5px);
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }

        .result-item {
            padding: 0.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .result-win {
            background: rgba(76,175,80,0.3);
            border: 2px solid #4CAF50;
        }

        .result-lose {
            background: rgba(244,67,54,0.3);
            border: 2px solid #f44336;
        }

        .card.winner {
            border-color: #4CAF50;
            box-shadow: 0 0 20px rgba(76,175,80,0.5);
        }

        .card.loser {
            border-color: #f44336;
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            .battlefield {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .battle-column {
                flex-direction: row;
                justify-content: space-around;
            }
            
            .column-label {
                writing-mode: vertical-lr;
                margin-bottom: 0;
                margin-right: 1rem;
            }
            
            .opponent-slot, .player-slot {
                width: 130px;
                height: 100px;
                margin-bottom: 0;
            }
            
            .card {
                width: 120px;
                height: 90px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title"><a href="https://jacobsargent.com/wiki/wikirogue.html">üåê WikiRogue</a></h1>
        
        <div class="stats">
            <div>Round: <span id="round">1</span></div>
        </div>

        <div class="battlefield">
            <div class="battle-column">
                <div class="column-label">Words</div>
                <div class="opponent-slot" id="opp-words"></div>
                <div class="player-slot" id="player-words" ondrop="drop(event, 'words')" ondragover="allowDrop(event)"></div>
            </div>
            <div class="battle-column">
                <div class="column-label">Views</div>
                <div class="opponent-slot" id="opp-views"></div>
                <div class="player-slot" id="player-views" ondrop="drop(event, 'views')" ondragover="allowDrop(event)"></div>
            </div>
            <div class="battle-column">
                <div class="column-label">Links</div>
                <div class="opponent-slot" id="opp-links"></div>
                <div class="player-slot" id="player-links" ondrop="drop(event, 'links')" ondragover="allowDrop(event)"></div>
            </div>
        </div>

        <div class="battle-result" id="battle-result">
            <h3>Battle Results</h3>
            <div class="result-grid" id="result-grid"></div>
            <div id="overall-result"></div>
        </div>

        <div class="player-hand" id="player-hand">
            <!-- Player cards will be inserted here -->
        </div>

        <div style="margin-top: 2rem; padding-bottom: 2rem;">
            <button class="button" id="battle-btn" onclick="startBattle()" disabled>Battle!</button>
            <button class="button" id="next-round-btn" onclick="nextRound()" style="display: none;">Next Round</button>
            <button class="button" id="new-game-btn" onclick="restartGame()" style="display: none;">New Game</button>
        </div>
    </div>

    <div class="game-over" id="game-over">
        <div class="game-over-content">
            <h2>üéØ Game Over!</h2>
            <p>You survived <span id="final-rounds">0</span> rounds!</p>
            <p>Final Round: <span id="final-score">0</span></p>
            <button class="button" onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <script>
        class WikipediaArticle {
            constructor(title, words, views, links) {
                this.title = title;
                this.words = words;
                this.views = views;
                this.links = links;
                this.revealed = {
                    words: false,
                    views: false,
                    links: false
                };
            }
        }

        // Sample Wikipedia articles with realistic stats
        const articlePool = [
            new WikipediaArticle("Albert Einstein", 15420, 2847291, 234),
            new WikipediaArticle("The Beatles", 18950, 3241876, 312),
            new WikipediaArticle("World War II", 28340, 4892013, 456),
            new WikipediaArticle("Leonardo da Vinci", 12840, 2156789, 189),
            new WikipediaArticle("Harry Potter", 9876, 1847293, 145),
            new WikipediaArticle("JavaScript", 11234, 934567, 167),
            new WikipediaArticle("Pizza", 6789, 1234567, 89),
            new WikipediaArticle("Bitcoin", 8932, 2876543, 134),
            new WikipediaArticle("Artificial Intelligence", 13456, 1987654, 203),
            new WikipediaArticle("Solar System", 16789, 2345678, 298),
            new WikipediaArticle("William Shakespeare", 19234, 2987654, 345),
            new WikipediaArticle("Ancient Egypt", 21876, 3456789, 387),
            new WikipediaArticle("Game of Thrones", 7654, 1876543, 112),
            new WikipediaArticle("Mount Everest", 8765, 1543210, 98),
            new WikipediaArticle("Minecraft", 5432, 2109876, 76),
            new WikipediaArticle("Photography", 10987, 1654321, 156),
            new WikipediaArticle("Ancient Rome", 17654, 2765432, 289),
            new WikipediaArticle("Electric Car", 9876, 1432109, 143),
            new WikipediaArticle("Quantum Physics", 14321, 1098765, 198),
            new WikipediaArticle("Olympic Games", 12109, 2543210, 178),
            new WikipediaArticle("Dinosaurs", 11876, 3210987, 167),
            new WikipediaArticle("Internet", 13210, 4321098, 234),
            new WikipediaArticle("Space Exploration", 15678, 1876543, 245),
            new WikipediaArticle("Climate Change", 18765, 2987654, 289),
            new WikipediaArticle("Human Brain", 16543, 2109876, 223)
        ];

        let gameState = {
            round: 1,
            wins: 0,
            score: 0,
            playerCards: [],
            opponentCards: [],
            playerSlots: { words: null, views: null, links: null },
            opponentSlots: { words: null, views: null, links: null },
            battleInProgress: false
        };

        function getRandomArticles(count) {
            const shuffled = [...articlePool].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count).map(article => {
                const newArticle = new WikipediaArticle(article.title, article.words, article.views, article.links);
                // All articles start with no revealed attributes
                newArticle.revealed = {
                    words: false,
                    views: false,
                    links: false
                };
                return newArticle;
            });
        }

        function createCardElement(article, isPlayer = true) {
            const card = document.createElement('div');
            card.className = 'card';
            if (isPlayer) {
                card.draggable = true;
                card.ondragstart = (e) => dragStart(e, article);
            }
            
            // Format values based on whether they're revealed
            const wordsDisplay = article.revealed.words ? 
                `<span class="stat-value">${article.words.toLocaleString()}</span>` : 
                `<span class="stat-hidden">???</span>`;
            
            const viewsDisplay = article.revealed.views ? 
                `<span class="stat-value">${article.views.toLocaleString()}</span>` : 
                `<span class="stat-hidden">???</span>`;
            
            const linksDisplay = article.revealed.links ? 
                `<span class="stat-value">${article.links}</span>` : 
                `<span class="stat-hidden">???</span>`;
            
            card.innerHTML = `
                <div class="card-title">${article.title}</div>
                <div class="card-stats">
                    <div class="stat-line">
                        <span>Words:</span>
                        ${wordsDisplay}
                    </div>
                    <div class="stat-line">
                        <span>Views:</span>
                        ${viewsDisplay}
                    </div>
                    <div class="stat-line">
                        <span>Links:</span>
                        ${linksDisplay}
                    </div>
                </div>
            `;
            
            return card;
        }

        function dealCards() {
            gameState.playerCards = getRandomArticles(3);
            gameState.opponentCards = getRandomArticles(3);
            
            // Clear previous cards
            const playerHand = document.getElementById('player-hand');
            playerHand.innerHTML = '';
            
            // Deal player cards
            gameState.playerCards.forEach(article => {
                const cardElement = createCardElement(article, true);
                playerHand.appendChild(cardElement);
            });
            
            // Place opponent cards randomly
            const slots = ['words', 'views', 'links'];
            const shuffledSlots = [...slots].sort(() => 0.5 - Math.random());
            
            gameState.opponentCards.forEach((article, index) => {
                const slot = shuffledSlots[index];
                gameState.opponentSlots[slot] = article;
                const slotElement = document.getElementById(`opp-${slot}`);
                slotElement.innerHTML = '';
                const opponentCard = createCardElement(article, false);
                opponentCard.draggable = false; // Explicitly ensure opponent cards aren't draggable
                slotElement.appendChild(opponentCard);
            });
        }

        function dragStart(event, article) {
            event.dataTransfer.setData('text/plain', JSON.stringify(article));
            event.target.classList.add('dragging');
        }

        function allowDrop(event) {
            event.preventDefault();
            event.target.classList.add('drag-over');
        }

        function drop(event, slotType) {
            event.preventDefault();
            event.target.classList.remove('drag-over');
            
            const articleData = event.dataTransfer.getData('text/plain');
            const article = JSON.parse(articleData);
            
            // Find the actual article object from playerCards to maintain revealed state
            const actualArticle = gameState.playerCards.find(card => card.title === article.title);
            if (!actualArticle) return;
            
            // Find which slot the dragged card came from (if any)
            let sourceSlot = null;
            for (const [slot, card] of Object.entries(gameState.playerSlots)) {
                if (card && card.title === actualArticle.title) {
                    sourceSlot = slot;
                    break;
                }
            }

            // Check if there's already a card in the target slot
            const existingCard = gameState.playerSlots[slotType];

            if (sourceSlot) {
                // Card is moving from one slot to another
                if (existingCard !== null) {
                    // Swap the cards
                    gameState.playerSlots[sourceSlot] = existingCard;
                    gameState.playerSlots[slotType] = actualArticle;
                    
                    // Update both slot visuals
                    const sourceSlotElement = document.getElementById(`player-${sourceSlot}`);
                    const targetSlotElement = document.getElementById(`player-${slotType}`);
                    
                    sourceSlotElement.innerHTML = '';
                    sourceSlotElement.appendChild(createCardElement(existingCard, false));
                    
                    targetSlotElement.innerHTML = '';
                    targetSlotElement.appendChild(createCardElement(actualArticle, false));
                } else {
                    // Moving to empty slot - clear source slot
                    gameState.playerSlots[sourceSlot] = null;
                    gameState.playerSlots[slotType] = actualArticle;
                    
                    // Update visuals
                    const sourceSlotElement = document.getElementById(`player-${sourceSlot}`);
                    const targetSlotElement = document.getElementById(`player-${slotType}`);
                    
                    sourceSlotElement.innerHTML = '';
                    targetSlotElement.innerHTML = '';
                    targetSlotElement.appendChild(createCardElement(actualArticle, false));
                }
                return;
            }

            // Place card in slot (from hand to slot)
            gameState.playerSlots[slotType] = actualArticle;
            const slotElement = document.getElementById(`player-${slotType}`);
            slotElement.innerHTML = '';
            slotElement.appendChild(createCardElement(actualArticle, false));
            
            // Remove card from hand if it came from hand
            const playerHand = document.getElementById('player-hand');
            const cards = playerHand.querySelectorAll('.card');
            cards.forEach(card => {
                if (card.querySelector('.card-title').textContent === actualArticle.title) {
                    card.remove();
                }
            });
            
            // Check if all slots are filled
            const filledSlots = Object.values(gameState.playerSlots).filter(slot => slot !== null);
            if (filledSlots.length === 3) {
                document.getElementById('battle-btn').disabled = false;
            }
        }

        function startBattle() {
            if (gameState.battleInProgress) return;
            
            gameState.battleInProgress = true;
            document.getElementById('battle-btn').style.display = 'none';
            
            // Reveal all stats for battle
            Object.values(gameState.playerSlots).forEach(card => {
                if (card) {
                    card.revealed.words = true;
                    card.revealed.views = true;
                    card.revealed.links = true;
                }
            });
            
            Object.values(gameState.opponentSlots).forEach(card => {
                if (card) {
                    card.revealed.words = true;
                    card.revealed.views = true;
                    card.revealed.links = true;
                }
            });
            
            // Update card visuals to show revealed stats
            ['words', 'views', 'links'].forEach(slot => {
                const playerSlot = document.getElementById(`player-${slot}`);
                const opponentSlot = document.getElementById(`opp-${slot}`);
                
                if (gameState.playerSlots[slot]) {
                    playerSlot.innerHTML = '';
                    playerSlot.appendChild(createCardElement(gameState.playerSlots[slot], false));
                }
                
                if (gameState.opponentSlots[slot]) {
                    opponentSlot.innerHTML = '';
                    opponentSlot.appendChild(createCardElement(gameState.opponentSlots[slot], false));
                }
            });
            
            const results = [];
            const slots = ['words', 'views', 'links'];
            
            slots.forEach(slot => {
                const playerCard = gameState.playerSlots[slot];
                const opponentCard = gameState.opponentSlots[slot];
                
                let playerWins = false;
                let comparison = '';
                
                if (slot === 'words') {
                    playerWins = playerCard.words > opponentCard.words;
                    comparison = `${playerCard.words.toLocaleString()} vs ${opponentCard.words.toLocaleString()}`;
                } else if (slot === 'views') {
                    playerWins = playerCard.views > opponentCard.views;
                    comparison = `${playerCard.views.toLocaleString()} vs ${opponentCard.views.toLocaleString()}`;
                } else if (slot === 'links') {
                    playerWins = playerCard.links > opponentCard.links;
                    comparison = `${playerCard.links} vs ${opponentCard.links}`;
                }
                
                results.push({
                    slot,
                    playerWins,
                    comparison,
                    playerCard: playerCard.title,
                    opponentCard: opponentCard.title
                });
            });
            
            // Display results
            displayBattleResults(results);
            
            // Calculate winner
            const playerWins = results.filter(r => r.playerWins).length;
            const roundWon = playerWins >= 2;
            
            if (roundWon) {
                gameState.wins++;
                gameState.score += gameState.round * 100;
                updateStats();
                document.getElementById('next-round-btn').style.display = 'inline-block';
            } else {
                // Game over - show new game button
                document.getElementById('new-game-btn').style.display = 'inline-block';
            }
        }

        function displayBattleResults(results) {
            const battleResult = document.getElementById('battle-result');
            const resultGrid = document.getElementById('result-grid');
            const overallResult = document.getElementById('overall-result');
            
            resultGrid.innerHTML = '';
            
            results.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = `result-item ${result.playerWins ? 'result-win' : 'result-lose'}`;
                resultItem.innerHTML = `
                    <strong>${result.slot.toUpperCase()}</strong><br>
                    ${result.playerWins ? '‚úÖ WIN' : '‚ùå LOSE'}<br>
                    <small>${result.comparison}</small>
                `;
                resultGrid.appendChild(resultItem);
                
                // Highlight winning/losing cards
                const playerSlot = document.getElementById(`player-${result.slot}`);
                const opponentSlot = document.getElementById(`opp-${result.slot}`);
                
                if (result.playerWins) {
                    playerSlot.querySelector('.card').classList.add('winner');
                    opponentSlot.querySelector('.card').classList.add('loser');
                } else {
                    playerSlot.querySelector('.card').classList.add('loser');
                    opponentSlot.querySelector('.card').classList.add('winner');
                }
            });
            
            const playerWins = results.filter(r => r.playerWins).length;
            const roundWon = playerWins >= 2;
            
            overallResult.innerHTML = `
                <h4>${roundWon ? 'üéâ Victory!' : 'üíÄ Defeat!'}</h4>
                <p>You won ${playerWins}/3 battles</p>
            `;
            
            battleResult.style.display = 'block';
        }

        function nextRound() {
            gameState.round++;
            gameState.battleInProgress = false;
            
            // Reset slots
            gameState.playerSlots = { words: null, views: null, links: null };
            gameState.opponentSlots = { words: null, views: null, links: null };
            
            // Clear slots
            ['words', 'views', 'links'].forEach(slot => {
                const playerSlot = document.getElementById(`player-${slot}`);
                const opponentSlot = document.getElementById(`opp-${slot}`);
                playerSlot.innerHTML = '';
                opponentSlot.innerHTML = '';
            });
            
            // Hide results and buttons
            document.getElementById('battle-result').style.display = 'none';
            document.getElementById('next-round-btn').style.display = 'none';
            document.getElementById('new-game-btn').style.display = 'none';
            document.getElementById('battle-btn').style.display = 'inline-block';
            document.getElementById('battle-btn').disabled = true;
            
            updateStats();
            dealCards();
        }

        function updateStats() {
            document.getElementById('round').textContent = gameState.round;
        }

        function showGameOver() {
            document.getElementById('final-rounds').textContent = gameState.round;
            document.getElementById('final-score').textContent = gameState.round;
            document.getElementById('game-over').style.display = 'flex';
        }

        function restartGame() {
            gameState = {
                round: 1,
                wins: 0,
                score: 0,
                playerCards: [],
                opponentCards: [],
                playerSlots: { words: null, views: null, links: null },
                opponentSlots: { words: null, views: null, links: null },
                battleInProgress: false
            };
            
            document.getElementById('game-over').style.display = 'none';
            document.getElementById('battle-result').style.display = 'none';
            document.getElementById('next-round-btn').style.display = 'none';
            document.getElementById('new-game-btn').style.display = 'none';
            document.getElementById('battle-btn').style.display = 'inline-block';
            document.getElementById('battle-btn').disabled = true;
            
            // Clear slots
            ['words', 'views', 'links'].forEach(slot => {
                const playerSlot = document.getElementById(`player-${slot}`);
                const opponentSlot = document.getElementById(`opp-${slot}`);
                playerSlot.innerHTML = '';
                opponentSlot.innerHTML = '';
            });
            
            updateStats();
            dealCards();
        }

        // Handle drag events
        document.addEventListener('dragend', (e) => {
            e.target.classList.remove('dragging');
        });

        document.addEventListener('dragleave', (e) => {
            if (e.target.classList.contains('slot')) {
                e.target.classList.remove('drag-over');
            }
        });

        // Initialize game
        dealCards();
    </script>
</body>
</html>